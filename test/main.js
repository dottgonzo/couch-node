"use strict";
var index_1 = require('../index');
var chai = require("chai");
var spawnPouchdbServer = require('spawn-pouchdb-server');
var expect = chai.expect;
var tmPort = 3434;
var couchDBDatabase = "http://localhost:" + tmPort + "/" + new Date().getTime;
var CouchManager;
before(function (done) {
    this.timeout(10000);
    spawnPouchdbServer({
        port: tmPort,
        backend: false,
        config: {
            file: false
        },
        log: {
            file: false,
            level: 'info'
        }
    }, function (error, server) {
        if (error) {
            throw error;
        }
        else {
            CouchManager = new index_1.default(couchDBDatabase);
            done();
        }
    });
});
describe("db testing", function () {
    var o;
    it("create db", function (done) {
        CouchManager.createDB().then(function (d) {
            expect(d).to.be.ok;
            done();
        }).catch(function (err) {
            done(Error(err));
        });
    });
    it("create a document", function (done) {
        CouchManager.create({
            _id: 'ff'
        }).then(function (d) {
            expect(d).to.be.ok;
            expect(d).to.be.an("Object").to.have.property("_id");
            expect(d).to.have.property("_rev");
            done();
        }).catch(function (err) {
            done(Error(err));
        });
    });
    it("find a document", function (done) {
        CouchManager.find('ff').then(function (d) {
            o = d;
            expect(d).to.be.an("Object").to.have.property("_id");
            expect(d).to.have.property("_rev");
            expect(d).to.be.ok;
            done();
        }).catch(function (err) {
            done(Error(err));
        });
    });
    it("update a document", function (done) {
        o.up = "updated";
        CouchManager.update(o).then(function (d) {
            expect(d).to.be.ok;
            expect(d).to.be.an("Object").to.have.property("up");
            expect(d).to.have.property("_id");
            expect(d).to.have.property("_rev");
            expect(d.up).to.be.eq("updated");
            done();
        }).catch(function (err) {
            done(Error(err));
        });
    });
    it("delete a document", function (done) {
        CouchManager.delete('ff').then(function () {
            CouchManager.find('ff').then(function (d) {
                done(Error("ff still exists"));
            }).catch(function () {
                done();
            });
        }).catch(function (err) {
            done(Error(err));
        });
    });
    it("create documents", function (done) {
        CouchManager.create_more([{
                _id: 'zz'
            }, {
                _id: 'ffs'
            }, {
                _id: 'ffg'
            }]).then(function (d) {
            expect(d).to.be.ok;
            expect(d).to.be.an("Array");
            expect(d[0]).to.be.an("Object").to.have.property("_id");
            expect(d[0]).to.be.an("Object").to.have.property("_rev");
            done();
        }).catch(function (err) {
            done(Error(err));
        });
    });
    it("update documents", function (done) {
        CouchManager.update_more([{
                _id: 'zz',
                upp: 'up2'
            }, {
                _id: 'ffs',
                upp: 'up2'
            }]).then(function (d) {
            expect(d).to.be.ok;
            expect(d).to.be.an("Array");
            expect(d[0]).to.be.an("Object").to.have.property("_id");
            expect(d[0]).to.be.an("Object").to.have.property("_rev");
            done();
        }).catch(function (err) {
            done(Error(err));
        });
    });
    it("search between keys", function (done) {
        CouchManager.betweenKeys('ffa', 'ffz').then(function (d) {
            expect(d).to.be.ok;
            done();
        }).catch(function (err) {
            done(Error(err));
        });
    });
    it("remove documents", function (done) {
        CouchManager.delete_more(['zz', 'ffs', 'ffg']).then(function (d) {
            expect(d).to.be.ok;
            done();
        }).catch(function (err) {
            done(Error(err));
        });
    });
});

//# sourceMappingURL=data:application/json;base64,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QUFDO1lBQ04sTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLFFBQVEsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ3JELE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUVuQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUM7WUFDbkIsSUFBSSxFQUFFLENBQUM7UUFFWCxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsVUFBQyxHQUFHO1lBQ1QsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFBO1FBQ3BCLENBQUMsQ0FBQyxDQUFBO0lBSU4sQ0FBQyxDQUFDLENBQUM7SUFHSCxFQUFFLENBQUMsbUJBQW1CLEVBQUUsVUFBVSxJQUFJO1FBQ2xDLENBQUMsQ0FBQyxFQUFFLEdBQUcsU0FBUyxDQUFDO1FBQ2pCLFlBQVksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQUMsQ0FBQztZQUMxQixNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUM7WUFDbkIsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLFFBQVEsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ3BELE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUNsQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDbkMsTUFBTSxDQUFDLENBQUMsQ0FB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LEdBQUcsQ0FBQyxDQUFDLENBQUE7UUFDcEIsQ0FBQyxDQUFDLENBQUE7SUFFTixDQUFDLENBQUMsQ0FBQztBQUVQLENBQUMsQ0FBQyxDQUFBIiwiZmlsZSI6InRlc3QvbWFpbi5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBDb3VjaE5vZGUgZnJvbSAnLi4vaW5kZXgnO1xuaW1wb3J0IGNoYWkgPSByZXF1aXJlKFwiY2hhaVwiKTtcblxubGV0IHNwYXduUG91Y2hkYlNlcnZlciA9IHJlcXVpcmUoJ3NwYXduLXBvdWNoZGItc2VydmVyJyk7XG5cbmxldCBleHBlY3QgPSBjaGFpLmV4cGVjdDtcblxubGV0IHRtUG9ydCA9IDM0MzQ7XG5cbmxldCBjb3VjaERCRGF0YWJhc2UgPSBcImh0dHA6Ly9sb2NhbGhvc3Q6XCIgKyB0bVBvcnQgKyBcIi9cIiArIG5ldyBEYXRlKCkuZ2V0VGltZTtcblxubGV0IENvdWNoTWFuYWdlcjtcblxuYmVmb3JlKGZ1bmN0aW9uIChkb25lKSB7XG4gICAgdGhpcy50aW1lb3V0KDEwMDAwKTtcbiAgICBzcGF3blBvdWNoZGJTZXJ2ZXIoXG4gICAgICAgIHtcbiAgICAgICAgICAgIHBvcnQ6IHRtUG9ydCxcbiAgICAgICAgICAgIGJhY2tlbmQ6IGZhbHNlLFxuICAgICAgICAgICAgY29uZmlnOiB7XG4gICAgICAgICAgICAgICAgZmlsZTogZmFsc2VcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBsb2c6IHtcbiAgICAgICAgICAgICAgICBmaWxlOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBsZXZlbDogJ2luZm8nXG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvciwgc2VydmVyKSB7XG4gICAgICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBlcnJvcjtcblxuICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgIENvdWNoTWFuYWdlciA9IG5ldyBDb3VjaE5vZGUoY291Y2hEQkRhdGFiYXNlKTtcblxuICAgICAgICAgICAgICAgIGRvbmUoKTtcblxuICAgICAgICAgICAgfVxuICAgICAgICB9KVxuXG59KTtcblxuZGVzY3JpYmUoXCJkYiB0ZXN0aW5nXCIsIGZ1bmN0aW9uICgpIHtcbiAgICBsZXQgbztcbiAgICBpdChcImNyZWF0ZSBkYlwiLCBmdW5jdGlvbiAoZG9uZSkge1xuICAgICAgICBDb3VjaE1hbmFnZXIuY3JlYXRlREIoKS50aGVuKChkKSA9PiB7XG5cbiAgICAgICAgICAgIGV4cGVjdChkKS50by5iZS5vaztcbiAgICAgICAgICAgIGRvbmUoKTtcblxuICAgICAgICB9KS5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgICAgICBkb25lKEVycm9yKGVycikpXG4gICAgICAgIH0pXG5cblxuXG4gICAgfSk7XG4gICAgaXQoXCJjcmVhdGUgYSBkb2N1bWVudFwiLCBmdW5jdGlvbiAoZG9uZSkge1xuICAgICAgICBDb3VjaE1hbmFnZXIuY3JlYXRlKHtcbiAgICAgICAgICAgIF9pZDogJ2ZmJ1xuICAgICAgICB9KS50aGVuKChkKSA9PiB7XG4gICAgICAgICAgICBleHBlY3QoZCkudG8uYmUub2s7XG4gICAgICAgICAgICBleHBlY3QoZCkudG8uYmUuYW4oXCJPYmplY3RcIikudG8uaGF2ZS5wcm9wZXJ0eShcIl9pZFwiKTtcbiAgICAgICAgICAgIGV4cGVjdChkKS50by5oYXZlLnByb3BlcnR5KFwiX3JldlwiKTtcbiAgICAgICAgICAgIGRvbmUoKTtcblxuICAgICAgICB9KS5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgICAgICBkb25lKEVycm9yKGVycikpXG4gICAgICAgIH0pXG5cblxuXG4gICAgfSk7XG4gICAgaXQoXCJmaW5kIGEgZG9jdW1lbnRcIiwgZnVuY3Rpb24gKGRvbmUpIHtcbiAgICAgICAgQ291Y2hNYW5hZ2VyLmZpbmQoJ2ZmJykudGhlbigoZCkgPT4ge1xuICAgICAgICAgICAgbyA9IGQ7XG4gICAgICAgICAgICBleHBlY3QoZCkudG8uYmUuYW4oXCJPYmplY3RcIikudG8uaGF2ZS5wcm9wZXJ0eShcIl9pZFwiKTtcbiAgICAgICAgICAgIGV4cGVjdChkKS50by5oYXZlLnByb3BlcnR5KFwiX3JldlwiKTtcblxuICAgICAgICAgICAgZXhwZWN0KGQpLnRvLmJlLm9rO1xuICAgICAgICAgICAgZG9uZSgpO1xuXG4gICAgICAgIH0pLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgICAgIGRvbmUoRXJyb3IoZXJyKSlcbiAgICAgICAgfSlcblxuXG5cbiAgICB9KTtcblxuXG4gICAgaXQoXCJ1cGRhdGUgYSBkb2N1bWVudFwiLCBmdW5jdGlvbiAoZG9uZSkge1xuICAgICAgICBvLnVwID0gXCJ1cGRhdGVkXCI7XG4gICAgICAgIENvdWNoTWFuYWdlci51cGRhdGUobykudGhlbigoZCkgPT4ge1xuICAgICAgICAgICAgZXhwZWN0KGQpLnRvLmJlLm9rO1xuICAgICAgICAgICAgZXhwZWN0KGQpLnRvLmJlLmFuKFwiT2JqZWN0XCIpLnRvLmhhdmUucHJvcGVydHkoXCJ1cFwiKTtcbiAgICAgICAgICAgIGV4cGVjdChkKS50by5oYXZlLnByb3BlcnR5KFwiX2lkXCIpO1xuICAgICAgICAgICAgZXhwZWN0KGQpLnRvLmhhdmUucHJvcGVydHkoXCJfcmV2XCIpO1xuICAgICAgICAgICAgZXhwZWN0KGQudXApLnRvLmJlLmVxKFwidXBkYXRlZFwiKTtcbiAgICAgICAgICAgIGRvbmUoKTtcblxuICAgICAgICB9KS5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgICAgICBkb25lKEVycm9yKGVycikpXG4gICAgICAgIH0pXG5cbiAgICB9KTtcblxuICAgIGl0KFwiZGVsZXRlIGEgZG9jdW1lbnRcIiwgZnVuY3Rpb24gKGRvbmUpIHtcbiAgICAgICAgQ291Y2hNYW5hZ2VyLmRlbGV0ZSgnZmYnKS50aGVuKCgpID0+IHtcblxuICAgICAgICAgICAgQ291Y2hNYW5hZ2VyLmZpbmQoJ2ZmJykudGhlbigoZCkgPT4ge1xuICAgICAgICAgICAgICAgIGRvbmUoRXJyb3IoXCJmZiBzdGlsbCBleGlzdHNcIikpXG5cblxuICAgICAgICAgICAgfSkuY2F0Y2goKCkgPT4ge1xuICAgICAgICAgICAgICAgIGRvbmUoKVxuICAgICAgICAgICAgfSlcblxuXG4gICAgICAgIH0pLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgICAgIGRvbmUoRXJyb3IoZXJyKSlcbiAgICAgICAgfSlcblxuXG5cbiAgICB9KTtcblxuICAgIGl0KFwiY3JlYXRlIGRvY3VtZW50c1wiLCBmdW5jdGlvbiAoZG9uZSkge1xuXG4gICAgICAgIENvdWNoTWFuYWdlci5jcmVhdGVfbW9yZShbe1xuICAgICAgICAgICAgX2lkOiAnenonXG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgICAgICBfaWQ6ICdmZnMnXG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgX2lkOiAnZmZnJ1xuICAgICAgICAgICAgfV0pLnRoZW4oKGQpID0+IHtcbiAgICAgICAgICAgICAgICBleHBlY3QoZCkudG8uYmUub2s7XG4gICAgICAgICAgICAgICAgZXhwZWN0KGQpLnRvLmJlLmFuKFwiQXJyYXlcIik7XG4gICAgICAgICAgICAgICAgZXhwZWN0KGRbMF0pLnRvLmJlLmFuKFwiT2JqZWN0XCIpLnRvLmhhdmUucHJvcGVydHkoXCJfaWRcIik7XG4gICAgICAgICAgICAgICAgZXhwZWN0KGRbMF0pLnRvLmJlLmFuKFwiT2JqZWN0XCIpLnRvLmhhdmUucHJvcGVydHkoXCJfcmV2XCIpO1xuICAgICAgICAgICAgICAgIGRvbmUoKTtcblxuICAgICAgICAgICAgfSkuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICAgICAgICAgIGRvbmUoRXJyb3IoZXJyKSlcbiAgICAgICAgICAgIH0pXG5cblxuICAgIH0pO1xuXG4gICAgaXQoXCJ1cGRhdGUgZG9jdW1lbnRzXCIsIGZ1bmN0aW9uIChkb25lKSB7XG4gICAgICAgIENvdWNoTWFuYWdlci51cGRhdGVfbW9yZShbe1xuICAgICAgICAgICAgX2lkOiAnenonLFxuICAgICAgICAgICAgdXBwOiAndXAyJ1xuICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgX2lkOiAnZmZzJyxcbiAgICAgICAgICAgICAgICB1cHA6ICd1cDInXG4gICAgICAgICAgICB9XSkudGhlbigoZCkgPT4ge1xuICAgICAgICAgICAgICAgIGV4cGVjdChkKS50by5iZS5vaztcbiAgICAgICAgICAgICAgICBleHBlY3QoZCkudG8uYmUuYW4oXCJBcnJheVwiKTtcbiAgICAgICAgICAgICAgICBleHBlY3QoZFswXSkudG8uYmUuYW4oXCJPYmplY3RcIikudG8uaGF2ZS5wcm9wZXJ0eShcIl9pZFwiKTtcbiAgICAgICAgICAgICAgICBleHBlY3QoZFswXSkudG8uYmUuYW4oXCJPYmplY3RcIikudG8uaGF2ZS5wcm9wZXJ0eShcIl9yZXZcIik7XG4gICAgICAgICAgICAgICAgZG9uZSgpO1xuXG4gICAgICAgICAgICB9KS5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgICAgICAgICAgZG9uZShFcnJvcihlcnIpKVxuICAgICAgICAgICAgfSlcblxuXG5cbiAgICB9KTtcblxuICAgIGl0KFwic2VhcmNoIGJldHdlZW4ga2V5c1wiLCBmdW5jdGlvbiAoZG9uZSkge1xuICAgICAgICBDb3VjaE1hbmFnZXIuYmV0d2VlbktleXMoJ2ZmYScsJ2ZmeicpLnRoZW4oKGQpID0+IHtcbiAgICAgICAgICAgIGV4cGVjdChkKS50by5iZS5vaztcbiAgICAgICAgICAgIGRvbmUoKTtcblxuICAgICAgICB9KS5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgICAgICBkb25lKEVycm9yKGVycikpXG4gICAgICAgIH0pXG5cbiAgICB9KTtcblxuICAgIGl0KFwicmVtb3ZlIGRvY3VtZW50c1wiLCBmdW5jdGlvbiAoZG9uZSkge1xuXG4gICAgICAgIENvdWNoTWFuYWdlci5kZWxldGVfbW9yZShbJ3p6JywgJ2ZmcycsICdmZmcnXSkudGhlbigoZCkgPT4ge1xuICAgICAgICAgICAgZXhwZWN0KGQpLnRvLmJlLm9rO1xuXG4gICAgICAgICAgICBkb25lKCk7XG5cbiAgICAgICAgfSkuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICAgICAgZG9uZShFcnJvcihlcnIpKVxuICAgICAgICB9KVxuXG4gICAgfSk7XG5cbn0pXG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
